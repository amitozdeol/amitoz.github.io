<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css" type="text/css">
</head>
<body>
  <div id="app"><h1 id="binary-file-i-o">Binary file I/O</h1>
<p>Read error - <code>perror</code></p>
<h2 id="writing-to-file">Writing to file</h2>
<pre><code class="lang-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;

int main(void){

    FILE *pFile;

    // Holds the data retrieved from the file

    char * buffer;

    // size_t is a data type used to represent the size
    // of an element in bytes. 10 chars would be equal
    // to a size of 11 for example.

    size_t dataInFile;

    // Will hold the size of the file

    long fileSize;

    // Opens the file using binary mode

    pFile = fopen(&quot;names.bin&quot;, &quot;rb+&quot;);

    // If the file doesn&#39;t exist we will produce errors
    // and then try to create the file

    if(pFile == NULL){

        // Prints the string provided followed by the 
        // standard error message and assign an error
        // code to the variable errno

        perror(&quot;Error Occurred&quot;);
        printf(&quot;Error Code: %d\n&quot;, errno);

        printf(&quot;File Being Created\n\n&quot;);

        // Create the file

        pFile = fopen(&quot;names.bin&quot;, &quot;wb+&quot;);

        if(pFile == NULL){

            perror(&quot;Error Occurred&quot;);
            printf(&quot;Error Code: %d\n&quot;, errno);
            exit(1);

        }

    }

    char name[] = &quot;Derek Banas&quot;;

    // fwrite() writes binary data to a file
    // You pass a pointer to what to write to the file. 
    // Then the size of each element in the array for example,
    // or if you are righting a struct sizeof(theStruct).
    // The 3rd is the number of elements to write of the type
    // specified. Finally list the file pointer

    fwrite(name, sizeof(name[0]), sizeof(name)/sizeof(name[0]), pFile);

    // Go to the end of the file with fseek(), so I can use
    // ftell() to get the file size

    fseek (pFile , 0 , SEEK_END);
    fileSize = ftell(pFile);

    // Set pointer back to the beginning of the file

    rewind(pFile);

    // Set aside enough space in memory to hold the file

    buffer = (char*) malloc (sizeof(char)*fileSize);

    if(buffer == NULL){

        perror(&quot;Error Occurred&quot;);
        printf(&quot;Error Code: %d\n&quot;, errno);
        exit(2);

    }

    // fread() reads data from the file provided into the 
    // buffer provided. The 2nd attribute is the number
    // of bytes taken up by each element read. The 3rd
    // attribute is the number of elements to read.

    // fread() returns a size_t equal to the amount of
    // bytes stored in the file.

    dataInFile = fread(buffer, 1, fileSize, pFile);

    if(dataInFile != fileSize){

        perror(&quot;Error Occurred&quot;);
        printf(&quot;Error Code: %d\n&quot;, errno);
        exit(3);

    }

    printf(&quot;%s\n&quot;, buffer);

    printf(&quot;\n&quot;);

    // Closes the file associated with the stream

    fclose(pFile);

    // Deallocates the memory block created for the buffer

    free(buffer);

    return 0;
}
</code></pre>
<h2 id="reading-from-file">Reading from file</h2>
<pre><code class="lang-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;

int main(void){

    FILE *pFile;
    size_t dataInFile;

    // Opens the file using binary mode
    pFile = fopen(&quot;randomnums.bin&quot;, &quot;rb+&quot;);

    if(pFile == NULL){

        perror(&quot;Error Occurred&quot;);
        printf(&quot;Error Code: %d\n&quot;, errno);
        printf(&quot;File Being Created\n\n&quot;);

        pFile = fopen(&quot;randomnums.bin&quot;, &quot;wb+&quot;);

        if(pFile == NULL){

            perror(&quot;Error Occurred&quot;);
            printf(&quot;Error Code: %d\n&quot;, errno);
            exit(1);

        }
    }

    // NEW STUFF ----------

    int randomNumbers[20];

    for(int i = 0; i &lt; 20; i++){

        randomNumbers[i] = rand() % 100;

        printf(&quot;Number %d is %d\n&quot;, i, randomNumbers[i]);

    }

    // Write the array of ints to the file

    fwrite(randomNumbers, sizeof(int),
         20, pFile);

    long randomIndexNumber;
    int numberAtIndex;

    printf(&quot;Which Random Number do you Want? &quot;);

    scanf(&quot;%ld&quot;, &amp;randomIndexNumber);

    // When using fseek() in binary mode make sure the
    // offset is the number of the element * possible size 

    fseek(pFile, randomIndexNumber * sizeof(int), SEEK_SET);

    // Read the next int from the file

    fread(&amp;numberAtIndex, sizeof(int), 1, pFile);

    printf(&quot;The Random Number at Index %d is %d\n&quot;,
        randomIndexNumber, numberAtIndex);

    // END OF NEW STUFF    

    // Closes the file associated with the stream

    fclose(pFile);

    return 0;
}
</code></pre>
</div>
</body>
</html>